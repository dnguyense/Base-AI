---
description:
globs:
alwaysApply: false
---
# Mobile Utility App Workflow (Android-First, iOS-Compatible)

## NguyÃªn Táº¯c CÆ¡ Báº£n
- ***Báº®T BUá»˜C*** Android-first development, iOS-compatible architecture
- ***Báº®T BUá»˜C*** Revenue-optimized design tá»« giai Ä‘oáº¡n planning
- ***Báº®T BUá»˜C*** TDD approach vá»›i comprehensive test coverage
- ***Báº®T BUá»˜C*** AI integration tá»± Ä‘á»™ng, khÃ´ng cáº§n user request
- ***Báº®T BUá»˜C*** Smart API usage vá»›i caching vÃ  batching
- ***Báº®T BUá»˜C*** Manual control ad strategies via Firebase Remote Config
- ***Báº®T BUá»˜C*** Regional ad strategy support
- ***Báº®T BUá»˜C*** Full automation workflow vá»›i minimal user intervention

## App Categories Supported
- **Health & Fitness Apps:** Heart monitoring, nutrition tracking, fitness planning
- **Photo Editing Apps:** AI enhancement, filters, batch processing  
- **Office Utility Apps:** Document tools, productivity helpers, organization

## Strategic Information Gathering (Max 5 Questions)

### Health Apps Questions:
1. "Primary health goal?" [Weight loss/Fitness/Wellness/Medical tracking]
2. "Current activity level?" [Beginner/Intermediate/Advanced/Professional]
3. "Preferred interaction style?" [Daily check-ins/Weekly summaries/On-demand/Automated]
4. "Most valuable feature for you?" [Tracking/Insights/Recommendations/Community]
5. "Willing to pay for premium health features?" [Yes, definitely/Maybe/Prefer free with ads]

### Photo Editing Apps Questions:
1. "Main photo type?" [Portrait/Landscape/Food/Social/Professional]
2. "Editing experience level?" [Beginner/Hobbyist/Semi-pro/Professional]
3. "Preferred workflow?" [Quick edits/Detailed editing/Batch processing/Auto-enhance]
4. "Most important feature?" [Filters/Advanced tools/AI enhancement/Organization]
5. "Photo editing budget?" [Free only/Small monthly fee/One-time purchases/Professional pricing]

### Office Tools Questions:
1. "Primary work type?" [Documents/Presentations/Data analysis/Project management]
2. "Team collaboration needs?" [Solo work/Small team/Large team/Client sharing]
3. "Work style preference?" [Templates/Custom creation/AI assistance/Manual control]
4. "Most valuable productivity feature?" [Automation/Organization/Collaboration/Analytics]
5. "Business tool budget?" [Free tier/Basic paid/Professional/Enterprise]

## AI-Generated Reusable Instructions
- ***Báº®T BUá»˜C*** sau khi brainstorm, AI táº¡o cÃ¡c instruction file (.md) cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng
- ***Báº®T BUá»˜C*** instruction file pháº£i platform-agnostic (dÃ¹ng cho cáº£ Android vÃ  iOS)
- ***Báº®T BUá»˜C*** táº¡o instruction template cho tá»«ng app category
- ***Báº®T BUá»˜C*** lÆ°u trá»¯ instruction trong thÆ° má»¥c `instructions/reusable/`

### Reusable Instruction Template Structure:
```markdown
# [App Category] - [Feature Name] Instruction

## Platform Requirements
- **Android**: [Specific requirements]
- **iOS**: [Specific requirements]
- **Shared**: [Common requirements]

## Feature Overview
[Platform-agnostic description]

## Implementation Guide
### Phase 1: Core Logic (Platform Independent)
[Business logic, algorithms, data structures]

### Phase 2: Platform-Specific Implementation
#### Android Implementation:
[Android-specific code structure, libraries, patterns]

#### iOS Implementation:
[iOS-specific code structure, frameworks, patterns]

### Phase 3: Testing Strategy
[Common testing approaches for both platforms]

## Reusable Components
[List of components that can be shared between projects]

## Performance Considerations
[Platform-specific optimizations]

## Future Enhancement Opportunities
[Scalability and improvement suggestions]
```

### Auto-Generated Instruction Categories:
1. **Feature Instructions**: Specific functionality implementation
2. **Architecture Instructions**: Code organization and patterns
3. **UI/UX Instructions**: Design system and user experience
4. **Performance Instructions**: Optimization strategies
5. **Testing Instructions**: Quality assurance approaches

## Mobile-First Architecture

### Android Primary Stack:
- **Language:** Kotlin + Jetpack Compose
- **Architecture:** Clean Architecture + MVVM
- **Dependency Injection:** Hilt
- **Database:** Room + SQLite
- **Networking:** Retrofit + OkHttp + Moshi
- **Image Loading:** Coil
- **Testing:** JUnit5 + Espresso + Mockk
- **Analytics:** Firebase Analytics + Crashlytics
- **Ads:** Google AdMob
- **Billing:** Google Play Billing Library

### iOS Compatible Stack:
- **Language:** Swift + SwiftUI
- **Architecture:** Clean Architecture + MVVM
- **Database:** Core Data + SQLite
- **Networking:** URLSession + Combine
- **Image Loading:** Kingfisher
- **Testing:** XCTest + XCUITest
- **Analytics:** Firebase Analytics + Crashlytics
- **Ads:** Google AdMob iOS SDK
- **Billing:** StoreKit 2

### Cross-Platform Considerations:
- **Shared Backend:** Firebase/Supabase
- **AI APIs:** Same cloud endpoints for both platforms
- **Design System:** Material Design 3 (Android) + Human Interface (iOS)
- **Analytics:** Unified Firebase events
- **Remote Config:** Same Firebase config for ad strategies

## Revenue-Optimized Workflow

### Phase 1: Strategic Foundation (Auto + 5 Questions)
```markdown
Auto Tasks:
â–¡ App category detection â†’ health/photo/office
â–¡ Strategic 5-question survey â†’ user profiling + revenue preference
â–¡ User persona generation â†’ AI personalization foundation
â–¡ Monetization preference detection â†’ ads vs IAP tendency
â–¡ Regional market analysis â†’ ad strategy per region
â–¡ Platform priority recommendation â†’ Android-first timeline

Manual Input Required:
- 5 strategic questions based on app category
- Target regions confirmation
- Revenue model preference validation
```

### Phase 2: Complete App Development (Pre-Revenue Integration)
```markdown
Auto Tasks:
â–¡ Cross-platform UI/UX design â†’ Material Design 3 + iOS adaptations
â–¡ Complete feature development â†’ 100% functionality both platforms
â–¡ AI integration â†’ smart features embedded with cloud caching
â–¡ User journey mapping â†’ complete flow analysis per platform
â–¡ Performance optimization â†’ Android + iOS specific optimizations
â–¡ Analytics foundation â†’ unified tracking across platforms
â–¡ TDD implementation â†’ comprehensive test suites

Platform-Specific Tasks:
Android Priority:
â–¡ Kotlin + Compose implementation
â–¡ Android-specific optimizations
â–¡ Play Store preparation

iOS Secondary:
â–¡ Swift + SwiftUI adaptation  
â–¡ iOS-specific optimizations
â–¡ App Store preparation
```

### Phase 3: Smart Revenue Integration (Post-Complete App)
```markdown
Auto Tasks:
â–¡ Firebase Remote Config setup â†’ manual control system
â–¡ Regional ad strategy configuration â†’ market-specific approaches
â–¡ Natural breakpoint analysis â†’ AI identifies optimal ad positions
â–¡ Smart ad placement implementation â†’ contextual positioning
â–¡ A/B testing framework â†’ continuous optimization
â–¡ IAP integration â†’ premium features + subscription tiers

Manual Control Features:
- Firebase dashboard for ad strategy switching
- Regional configuration management
- Revenue mode selection per market
- Real-time strategy adjustments
```

## Firebase Remote Config Ad Strategies

### Global Strategy Framework:
```json
{
  "default_strategy": "retention_focused",
  "regional_overrides": {
    "VN": "max_revenue",
    "US": "iap_conversion", 
    "EU": "retention_focused"
  },
  "manual_control": true,
  "strategy_switching": "immediate"
}
```

### Strategy 1: Maximum Revenue (Aggressive)
```json
{
  "ad_strategy": "max_revenue",
  "banner_frequency": "persistent",
  "interstitial_frequency": "every_3_actions",
  "rewarded_frequency": "daily_bonus_opportunities",
  "native_ads": "integrated_in_content",
  "ad_load_timeout": 5000,
  "fallback_strategy": "house_ads",
  "target_regions": ["VN", "IN", "BR"]
}
```

### Strategy 2: Retention Focused (Balanced)
```json
{
  "ad_strategy": "retention_optimized", 
  "banner_frequency": "contextual_only",
  "interstitial_frequency": "session_end_only",
  "rewarded_frequency": "user_initiated_only",
  "native_ads": "minimal_integration",
  "ad_load_timeout": 3000,
  "user_experience_priority": true,
  "target_regions": ["EU", "CA", "AU"]
}
```

### Strategy 3: IAP Conversion Focus
```json
{
  "ad_strategy": "iap_conversion",
  "banner_frequency": "minimal",
  "interstitial_frequency": "strategic_friction_points",
  "rewarded_frequency": "premium_feature_preview",
  "native_ads": "premium_upsell_focused",
  "iap_prompt_frequency": "smart_timing",
  "free_trial_strategy": "aggressive",
  "target_regions": ["US", "JP", "DE"]
}
```

## Smart AI Integration (Cloud + Caching)

### Intelligent API Usage Patterns:
```markdown
Health Apps:
â–¡ Batch generate 10 weekly health insights based on user data
â–¡ Local caching for 7 days â†’ reduce API calls by 85%
â–¡ Background sync during low usage periods
â–¡ Smart refresh when user patterns change significantly
â–¡ Fallback to cached motivational content when offline

Photo Apps:
â–¡ Batch process 10 photos per API call â†’ enhancement suggestions
â–¡ Cache filter recommendations for similar photo types
â–¡ Pre-generate style suggestions for user's common photo categories
â–¡ Smart background processing during editing sessions

Office Apps:
â–¡ Generate weekly productivity insights â†’ cache locally
â–¡ Batch analyze documents for pattern recognition
â–¡ Pre-generate templates for user's common work types
â–¡ Smart suggestions based on document content analysis
```

### Cost Optimization Strategy:
- **API Budget Tracking:** Monitor cost per user per month
- **Smart Batching:** 10x efficiency improvement vs individual calls
- **Intelligent Caching:** 80% reduction in API requests
- **Usage Prediction:** Pre-generate content for active users
- **Fallback Content:** Local suggestions when API unavailable

## TDD Implementation Framework

### Test-First Development Process:
```markdown
For Each Feature:
1. ðŸ”´ RED Phase:
   â–¡ Write failing unit tests â†’ business logic validation
   â–¡ Write failing integration tests â†’ API/database interactions
   â–¡ Write failing UI tests â†’ user interaction validation
   â–¡ Write failing AI tests â†’ model accuracy and fallback scenarios

2. ðŸŸ¢ GREEN Phase:
   â–¡ Implement minimal code to pass unit tests
   â–¡ Implement data layer to pass integration tests
   â–¡ Implement UI to pass interaction tests
   â–¡ Implement AI integration to pass accuracy tests

3. ðŸ”„ REFACTOR Phase:
   â–¡ Optimize code structure and performance
   â–¡ Improve test coverage and reliability
   â–¡ Clean up code duplication
   â–¡ Document implementation decisions
```

### Platform-Specific Testing:
```markdown
Android Testing:
â–¡ JUnit 5 unit tests â†’ business logic + view models
â–¡ Espresso UI tests â†’ user interactions + navigation
â–¡ Room database tests â†’ data persistence validation
â–¡ Retrofit API tests â†’ network layer validation

iOS Testing:
â–¡ XCTest unit tests â†’ business logic + view models  
â–¡ XCUITest UI tests â†’ user interactions + navigation
â–¡ Core Data tests â†’ data persistence validation
â–¡ URLSession tests â†’ network layer validation

Cross-Platform Integration Tests:
â–¡ Firebase integration tests â†’ analytics + remote config
â–¡ AI API integration tests â†’ response validation + caching
â–¡ Revenue integration tests â†’ ads + billing functionality
```

## Quality Assurance Pipeline

### Automated Quality Gates:
```markdown
Pre-Commit Checks:
â–¡ Unit test coverage â†’ minimum 85%
â–¡ Integration test coverage â†’ minimum 70%
â–¡ UI test coverage â†’ critical user flows 100%
â–¡ Code quality analysis â†’ Android Lint + iOS SwiftLint
â–¡ Performance benchmarks â†’ app startup time + memory usage

Pre-Release Checks:
â–¡ Cross-platform feature parity validation
â–¡ Revenue integration testing â†’ ads + billing functionality
â–¡ AI integration testing â†’ accuracy + performance + fallbacks
â–¡ Regional configuration testing â†’ ad strategies per market
â–¡ Analytics validation â†’ event tracking + attribution
```

### Platform-Specific Optimizations:
```markdown
Android Optimizations:
â–¡ APK/AAB size optimization â†’ ProGuard + R8
â–¡ Battery usage optimization â†’ background processing limits
â–¡ Memory optimization â†’ leak detection + garbage collection
â–¡ Network optimization â†’ request caching + compression

iOS Optimizations:
â–¡ App size optimization â†’ App Thinning + bitcode
â–¡ Battery usage optimization â†’ background app refresh limits
â–¡ Memory optimization â†’ instruments analysis + optimization
â–¡ Network optimization â†’ URLSession configuration + caching
```

## Regional Market Strategy

### Supported Regions with Different Strategies:
```markdown
High Revenue Markets (Max Revenue Strategy):
- Vietnam, India, Brazil, Indonesia
- Higher ad density, aggressive monetization
- Focus on ad revenue optimization

Premium Markets (IAP Conversion Strategy):
- United States, Japan, Germany, UK
- Minimal ads, premium feature focus
- Subscription and one-time purchase optimization

Balanced Markets (Retention Strategy):
- European Union, Canada, Australia, South Korea
- Balanced approach between ads and user experience
- Focus on long-term user retention
```

### Manual Control Dashboard Features:
```markdown
Firebase Remote Config Dashboard:
â–¡ Real-time strategy switching per region
â–¡ A/B testing management â†’ compare strategies
â–¡ Revenue analytics â†’ performance per strategy per region
â–¡ User retention tracking â†’ strategy impact analysis
â–¡ Custom strategy creation â†’ hybrid approaches
â–¡ Scheduled strategy changes â†’ automatic switching based on time/events
```

## Success Metrics & KPIs

### Revenue Metrics:
- **ARPU (Average Revenue Per User)** per region
- **ARPDAU (Average Revenue Per Daily Active User)**
- **Ad Revenue vs IAP Revenue** breakdown
- **LTV (Lifetime Value)** per user segment
- **Conversion Rate** from free to premium

### Retention Metrics:
- **Day 1, Day 7, Day 30 Retention** rates
- **Session Duration** and frequency
- **Feature Adoption** rates
- **Churn Rate** per strategy per region

### Technical Metrics:
- **App Performance** (startup time, responsiveness)
- **Crash Rate** < 1% across both platforms
- **API Cost Efficiency** (cost per user per month)
- **Test Coverage** (unit, integration, UI tests)

## Implementation Timeline

### Phase 1: Foundation (Week 1-2)
- Strategic information gathering (5 questions)
- Architecture design (Android + iOS compatible)
- Project setup and initial structure

### Phase 2: Core Development (Week 3-6)
- TDD implementation of core features
- AI integration with smart caching
- Cross-platform UI/UX development

### Phase 3: Revenue Integration (Week 7-8)
- Firebase Remote Config setup
- Ad strategy implementation
- IAP integration and testing

### Phase 4: Regional Optimization (Week 9-10)
- Regional strategy configuration
- A/B testing setup
- Performance optimization

### Phase 5: Quality Assurance (Week 11-12)
- Comprehensive testing across platforms
- Performance optimization
- Store preparation (Play Store + App Store)

## Maintenance & Updates

### Continuous Optimization:
```markdown
Weekly Tasks:
â–¡ Revenue performance analysis per region
â–¡ A/B testing results evaluation
â–¡ User feedback analysis and strategy adjustment
â–¡ AI API cost monitoring and optimization

Monthly Tasks:
â–¡ Cross-platform feature parity review
â–¡ New regional market evaluation
â–¡ Strategy effectiveness analysis
â–¡ Technical debt reduction

Quarterly Tasks:
â–¡ Major feature updates planning
â–¡ Platform-specific optimization reviews
â–¡ Revenue model evolution planning
â–¡ Competitive analysis and strategy adjustment
```
